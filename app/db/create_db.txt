CREATE TABLE user
(
    id   INT PRIMARY KEY,
    name VARCHAR
);

CREATE TABLE category
(
    id      INTEGER NOT NULL
    PRIMARY KEY
  AUTOINCREMENT,
  user_id INT,
  name    VARCHAR,
  color   VARCHAR(6)
);

CREATE TABLE feed_item
(
    id        INTEGER NOT NULL
    PRIMARY KEY,
  feed_id   INT,
  local_id  VARCHAR,
  title     VARCHAR,
  thumbnail VARCHAR,
  content   TEXT,
  link      VARCHAR,
  date_time DATETIME,
  read      ENUM(0, 1) DEFAULT 0 NOT NULL
);

CREATE TABLE subscription
(
    id                         INTEGER NOT NULL
    PRIMARY KEY
                                        AUTOINCREMENT,
  name                       VARCHAR,
  url                        TEXT,
  user_id                    INT,
  category_id                INT
    CONSTRAINT subscription_category_id_fk
    REFERENCES category (id),
  last_modification_datetime DATETIME,
  need_update                ENUM(0, 1) DEFAULT 0,
  last_check_datetime        DATETIME,
  recuperation_data_datetime DATETIME,
  is_valid                   ENUM(0, 1) DEFAULT 1,
  url_site                   TEXT,
  need_parse                 ENUM(0, 1) DEFAULT 0 NOT NULL
);

CREATE TABLE subscription_item
(
    id              INTEGER NOT NULL
    PRIMARY KEY
                             AUTOINCREMENT,
  subscription_id INT
    CONSTRAINT subscription_item_subscription_id_fk
    REFERENCES subscription (id)
      ON UPDATE CASCADE
      ON DELETE CASCADE,
  local_id        VARCHAR,
  title           VARCHAR,
  thumbnail       VARCHAR,
  content         TEXT,
  link            TEXT,
  date_time       DATETIME,
  read            ENUM(0, 1) DEFAULT 0
);

ALTER TABLE category
  ADD constraint category_user_id_fk
  FOREIGN KEY (user_id) REFERENCES user (id)
ON UPDATE cascade ON DELETE CASCADE;

ALTER TABLE subscription
  ADD constraint subscription_user_id_fk
  FOREIGN KEY (user_id) REFERENCES user (id)
ON UPDATE cascade ON DELETE CASCADE;

INSERT INTO user (name) VALUES (admin);